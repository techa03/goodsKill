= å‰è¨€

image:https://img.shields.io/badge/license-MIT-blue.svg[License,link=LICENSE]
image:https://github.com/techa03/goodsKill/actions/workflows/maven.yml/badge.svg?branch=master[Java CI with Maven,link=https://github.com/techa03/goodsKill/actions/workflows/maven.yml]
image:https://codecov.io/gh/techa03/goodsKill/branch/master/graph/badge.svg[codecov,link=https://codecov.io/gh/techa03/goodsKill]
image:https://github.com/techa03/goodsKill/actions/workflows/codeql.yml/badge.svg?branch=master[CodeQL,link=https://github.com/techa03/goodsKill/actions/workflows/codeql.yml]

é¡¹ç›®å‘½åä¸º *goodsKill* ä¸€æ–¹é¢æœ‰å•†å“ç§’æ€çš„æ„æ€(å¥½åƒæœ‰ç‚¹chinglishçš„å‘³é“)ï¼Œå¦å¤–ä¹Ÿå¯ç†è§£ä¸º *good skill*ï¼Œæœ¬é¡¹ç›®å°±æ˜¯å¸Œæœ›æ­å»ºä¸€å¥—å®Œæ•´çš„é¡¹ç›®æ¡†æ¶ï¼ŒæŠŠä¸€äº›å¥½çš„æŠ€æœ¯å’Œå¼€å‘æŠ€å·§æ•´åˆè¿›æ¥ï¼ˆåå‘äºåç«¯æŠ€æœ¯ï¼‰ï¼Œæ–¹ä¾¿å­¦ä¹ å’ŒæŸ¥é˜…ã€‚


æœ¬é¡¹ç›®ä¸ºæ¨¡æ‹Ÿç§’æ€é¡¹ç›®ï¼Œæä¾›ç»Ÿä¸€ç§’æ€æ¨¡æ‹Ÿè¯·æ±‚æ¥å£ï¼ŒæŠ€æœ¯ä¸Šæ•´ä½“é‡‡ç”¨SpringMVC + MybatisæŒä¹…å±‚æ¡†æ¶ï¼Œé‡‡ç”¨Dubbo3.x{empty}footnote:[ç”±äºSpringCloudAlibabaå®˜æ–¹æš‚æœªæ”¯æŒDubbo 3.xï¼Œæœ¬é¡¹ç›®é‡‡ç”¨dubbo-spring-boot-starteré›†æˆ]ï¼ŒæœåŠ¡æ³¨å†Œå‘ç°ä»¥åŠé…ç½®ä¸­å¿ƒä½¿ç”¨Nacosï¼Œæ”¯æŒæ•°æ®åº“åˆ†åº“åˆ†è¡¨ã€åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä½¿ç”¨çŠ¶æ€æœºå®Œæˆæ•°æ®çŠ¶æ€é—´çš„è½¬æ¢ï¼ˆåŸºäºSpring Statemachineå®ç°ï¼‰ã€‚

== ğŸ’ åˆ†æ”¯ä»‹ç»

``master``åˆ†æ”¯åŸºäºæœ€æ–°Spring Cloud 2023.x + Spring Boot 3.x + JDK21ä½“ç³»æ„å»ºï¼Œç›®å‰ä»…ä¿ç•™æ ¸å¿ƒçš„æ¨¡æ‹Ÿç§’æ€APIæ¥å£ï¼Œå¦‚éœ€ä½¿ç”¨Spring Boot 2.7.x + JDK11ç‰ˆæœ¬å¯ä»¥åˆ‡æ¢åˆ°tag https://github.com/techa03/goodsKill/tree/v2.7.4[v2.7.4]ï¼ˆæ”¯æŒç™»å½•æ³¨å†Œä»¥åŠç®€å•çš„åå°ç®¡ç†åŠŸèƒ½ï¼‰ã€‚masteråˆ†æ”¯ç›®å‰å‡çº§æ”¹é€ ä¸­ï¼ŒåŠŸèƒ½ä¸å¤Ÿç¨³å®šï¼Œå¦‚é‡ä»£ç æŠ¥é”™å»ºè®®ä½¿ç”¨è€ç‰ˆæœ¬ã€‚

æœ¬é¡¹ç›®åŠŸèƒ½ç›®å‰æ¯”è¾ƒç®€é™‹ä¸”æœ‰å¾ˆå¤šä¸å®Œå–„çš„åœ°æ–¹ï¼ŒçœŸå®çš„ç§’æ€åœºæ™¯è¿œæ¯”æœ¬é¡¹ç›®ä¸­çš„å®ç°æ–¹å¼å¤æ‚ï¼Œæœ¬é¡¹ç›®çœç•¥äº†çœŸå®åœºæ™¯ä¸­çš„éƒ¨åˆ†æŠ€æœ¯å®ç°ç»†èŠ‚ï¼Œç›®å‰ä»…ä½œå­¦ä¹ å‚è€ƒä¹‹ç”¨ï¼Œå¦‚æœè§‰å¾—æœ¬é¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©çš„è¯·å¤šå¤šstaræ”¯æŒä¸€ä¸‹ğŸ‘~~~~ã€‚
____

é™„ï¼šç äº‘é¡¹ç›®é“¾æ¥ `https://gitee.com/techa/goodsKill`,cloneé€Ÿåº¦æ…¢çš„ç”¨ç äº‘ä»“åº“æ‹‰å§ï¼Œä¸å®šæœŸåŒæ­¥åˆ°ç äº‘~

____

== âœ¨ æŠ€æœ¯é€‰å‹

|===
|ä½¿ç”¨çš„å·¥å…·æˆ–æ¡†æ¶ |åç§° |å®˜ç½‘

|Spring Boot |Spring Bootæ¡†æ¶ |https://spring.io/projects/spring-boot
|MyBatis-Plus |MyBatiså¢å¼ºå·¥å…· |https://mp.baomidou.com/
|ZooKeeper |åˆ†å¸ƒå¼åè°ƒæœåŠ¡ |http://zookeeper.apache.org/
|Redis |åˆ†å¸ƒå¼ç¼“å­˜æ•°æ®åº“ |https://redis.io/
|Kafka |æ¶ˆæ¯é˜Ÿåˆ— |http://kafka.apache.org/
|RabbitMQ |æ¶ˆæ¯é˜Ÿåˆ— |https://www.rabbitmq.com/
|MongoDB |Mongoæ•°æ®åº“ |https://www.mongodb.com/
|MySQL |MySQLæ•°æ®åº“ |https://www.mysql.com/
|Elasticsearch |å…¨æ–‡æœç´¢å¼•æ“ |https://www.elastic.co
|Sharding-JDBC |åˆ†åº“åˆ†è¡¨ç»„ä»¶ |https://shardingsphere.apache.org
|Spring Cloud Alibaba |Cloud Alibabaç»„ä»¶ |https://github.com/alibaba/spring-cloud-alibaba
|Apache Dubbo | RPCæœåŠ¡è¿œç¨‹è°ƒç”¨æ¡†æ¶ |https://github.com/apache/dubbo
|Spring Cloud Gateway |ç½‘å…³ç»„ä»¶ |https://spring.io/projects/spring-cloud-gateway
|Seata |åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ |http://seata.io/zh-cn/index.html
|Spring Security OAuth2.0 |OAuth2.0æˆæƒç»„ä»¶ |https://spring.io/projects/spring-security-oauth
|GraphQL |ä¸€ç§ç”¨äº API çš„æŸ¥è¯¢è¯­è¨€ |https://docs.spring.io/spring-graphql/docs/current/reference/html
|Spring Statemachine |Spring çŠ¶æ€æœº |https://spring.io/projects/spring-statemachine
|Sa-Token |è½»é‡çº§æƒé™è®¤è¯æ¡†æ¶ |https://sa-token.cc/
|===

== ğŸ“ é¡¹ç›®æ¨¡å—ä»‹ç»

----
goodsKill
|--goodskill-admin                          ||SpringBoot Adminç›‘æ§æœåŠ¡ç«¯ï¼Œæ”¯æŒSpring Cloudå¾®æœåŠ¡å‘ç°
|--goodskill-gateway                        ||å¾®æœåŠ¡APIç½‘å…³ï¼Œç»Ÿä¸€æœåŠ¡é‰´æƒï¼Œæ”¯æŒåŠ¨æ€è·¯ç”±åŠ è½½
|--goodskill-order-provider                 ||è®¢å•æœåŠ¡æä¾›è€…
|   |--goodskill-order-service
|--goodskill-seckill-provider               ||ç§’æ€æœåŠ¡æä¾›è€…
|   |--goodskill-api                        ||æä¾›æœåŠ¡APIæ¥å£
|   |--goodskill-service                    ||æœåŠ¡APIæ¥å£å®ç°
|--goodskill-spring-boot-starter            ||é¡¹ç›®é…ç½®è‡ªåŠ¨è£…é…
|--goodskill-web                            ||æä¾›ç§’æ€æ¨¡æ‹Ÿæ¥å£è®¿é—®
|--goodskill-job                            ||elastic-jobå®šæ—¶ä»»åŠ¡
|--goodskill-seata                          ||é›†æˆnacos+dubbo+shardingjdbc+seataçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆç¤ºä¾‹
|--goodskill-auth                           ||authç™»å½•ä»¥åŠæˆæƒæ¨¡å—
|   |--auth-service                         ||åŸºäºSa-Tokenæ¡†æ¶çš„ç”¨æˆ·ç™»å½•æˆæƒæœåŠ¡
    |--oauth2-auth-server                   ||oauth2.0ç™»å½•æˆæƒæœåŠ¡ç«¯ï¼Œè‡ªå®šä¹‰çš„ç™»å½•æˆæƒæœåŠ¡
    |--oauth2-resource-server               ||oauth2.0èµ„æºæœåŠ¡ç«¯ï¼Œè‡ªå®šä¹‰çš„ç™»å½•æˆæƒæœåŠ¡
----

== ğŸ”¥ğŸ”¥ ç§’æ€æ–¹æ¡ˆ

ç›®å‰å®ç°äº†å‡ ç§ç§’æ€æ–¹æ¡ˆï¼Œé€šè¿‡``SeckillMockController``æä¾›æµ‹è¯•æ¥å£

èšåˆç½‘å…³Openapiæ–‡æ¡£åœ°å€: `http://localhost/doc.html#/home`ï¼ˆéœ€è¦å¼€å¯ç½‘å…³æœåŠ¡ï¼‰

Spring Boot Adminåº”ç”¨ç›‘æ§åœ°å€: `http://www.goodskill.com:19031`, ç™»å½•ç”¨æˆ·åå¯†ç ï¼šuser/123456

* åœºæ™¯ä¸€ï¼šSychronizedåŒæ­¥é”å®ç°
* åœºæ™¯äºŒï¼šRedissonåˆ†å¸ƒå¼é”å®ç°
* åœºæ™¯ä¸‰ï¼šActiveMQå®ç°(å·²åºŸå¼ƒ)
* åœºæ™¯å››ï¼šKafkaæ¶ˆæ¯é˜Ÿåˆ—å®ç°
* åœºæ™¯äº”ï¼šæ•°æ®åº“åŸå­æ€§æ›´æ–°
* åœºæ™¯å…­ï¼šå®æ—¶ç­‰å¾…ç§’æ€å¤„ç†ç»“æœ(å·²åºŸå¼ƒ)
* åœºæ™¯ä¸ƒï¼šZooKeeperåˆ†å¸ƒå¼é”
* åœºæ™¯å…«ï¼šä½¿ç”¨Redisè¿›è¡Œç§’æ€å•†å“å‡åº“å­˜æ“ä½œï¼Œç§’æ€ç»“æŸåå¼‚æ­¥å‘é€MQï¼Œä½¿ç”¨MongoDBå®Œæˆæ•°æ®è½åœ°
* åœºæ™¯ä¹ï¼šSpring Cloud Streamå®ç°
* åœºæ™¯åï¼šSentinelé™æµ+æ•°æ®åº“åŸå­æ€§æ›´æ–°ï¼ˆéœ€æ­é…sentinelæ§åˆ¶å°é…ç½®èµ„æºå``limit``çš„æµæ§è§„åˆ™ï¼‰


.å¯åœ¨webæ§å°æŸ¥çœ‹ç§’æ€ç»“æœï¼Œæ‰“å°ä¿¡æ¯ç±»ä¼¼ï¼š
[%collapsible]
====
[source,text]
----
2021-04-14 21:58:59.857  INFO [goodskill-web,df43cc8f59291c48,df43cc8f59291c48] 15808 --- [           main] o.s.w.controller.SeckillMockController   : ç§’æ€åœºæ™¯äºŒ(redisåˆ†å¸ƒå¼é”å®ç°)å¼€å§‹æ—¶é—´ï¼šWed Apr 14 21:58:59 CST 2021,ç§’æ€idï¼š1000
2021-04-14 21:59:00.094  INFO [goodskill-web,144aa7910cca9520,2821cb8d62c5a908] 15808 --- [AClOSzbugzYng-1] o.s.w.s.c.SeckillMockResponseListener    : ç§’æ€æ´»åŠ¨ç»“æŸï¼Œç§’æ€åœºæ™¯äºŒ(redisåˆ†å¸ƒå¼é”å®ç°)æ—¶é—´ï¼šWed Apr 14 21:59:00 CST 2021,ç§’æ€idï¼š1000
2021-04-14 21:59:00.101  INFO [goodskill-web,144aa7910cca9520,2821cb8d62c5a908] 15808 --- [AClOSzbugzYng-1] o.s.w.s.c.SeckillMockResponseListener    : æœ€ç»ˆæˆåŠŸäº¤æ˜“ç¬”æ•°ç»Ÿè®¡ä¸­ã€‚ã€‚ã€‚
2021-04-14 21:59:01.616  INFO [goodskill-web,144aa7910cca9520,2821cb8d62c5a908] 15808 --- [AClOSzbugzYng-1] o.s.w.s.c.SeckillMockResponseListener    : æœ€ç»ˆæˆåŠŸäº¤æ˜“ç¬”æ•°ç»Ÿè®¡ä¸­ã€‚ã€‚ã€‚
2021-04-14 21:59:03.129  INFO [goodskill-web,144aa7910cca9520,2821cb8d62c5a908] 15808 --- [AClOSzbugzYng-1] o.s.w.s.c.SeckillMockResponseListener    : æœ€ç»ˆæˆåŠŸäº¤æ˜“ç¬”æ•°ï¼š10
2021-04-14 21:59:03.130  INFO [goodskill-web,144aa7910cca9520,2821cb8d62c5a908] 15808 --- [AClOSzbugzYng-1] o.s.w.s.c.SeckillMockResponseListener    : å†å²ä»»åŠ¡è€—æ—¶ç»Ÿè®¡ï¼šStopWatch '': running time = 36159894800 ns
---------------------------------------------
ns         %     Task name
---------------------------------------------
4492195700  012%  ç§’æ€åœºæ™¯å››(kafkaæ¶ˆæ¯é˜Ÿåˆ—å®ç°)
3164155900  009%  ç§’æ€åœºæ™¯å…«(ç§’æ€å•†å“å­˜æ”¾rediså‡åº“å­˜ï¼Œå¼‚æ­¥å‘é€ç§’æ€æˆåŠŸMQï¼ŒmongoDbæ•°æ®è½åœ°)
6219218300  017%  ç§’æ€åœºæ™¯å(Sentinelé™æµ+æ•°æ®åº“åŸå­æ€§æ›´æ–°)
9189080600  025%  ç§’æ€åœºæ™¯ä¸ƒ(zookeeperåˆ†å¸ƒå¼é”)
3135926500  009%  ç§’æ€åœºæ™¯äº”(æ•°æ®åº“åŸå­æ€§æ›´æ–°update set num = num -1)
3342791800  009%  ç§’æ€åœºæ™¯ä¹(åŸºäºspringcloud stream rabbitmq)
3343433700  009%  ç§’æ€åœºæ™¯ä¸€(sychronizedåŒæ­¥é”å®ç°)
3273092300  009%  ç§’æ€åœºæ™¯äºŒ(redisåˆ†å¸ƒå¼é”å®ç°)
----
====

== ğŸ§° å¼€å‘ç¯å¢ƒç‰ˆæœ¬è¯´æ˜

* JDK: OpenJDK21
* Sharding-JDBC: 5.5.0
* SpringCloud: 2023.x.x
* SpringBoot: 3.2.x
* SpringCloudAlibaba: 2023.x.x
* Apache Dubbo: 3.x
* ä½¿ç”¨çš„Dockeré•œåƒ
+
|===
|é•œåƒ |ç‰ˆæœ¬ |ç«¯å£ |ç”¨æˆ·åå¯†ç 

|Nacos |2.3.2-slim |8848 |nacos:nacos
|Redis |latest |6379 |å¯†ç :123456
|Kafka |3.1.1 |9092 |æ— 
|KafkaManager |latest |9001:9000 |æ— 
|Mongo |6.0.7 |27017 |æ— 
|MySQL |8.0.29 |3306 |root:Password123
|Zookeeper |3.6.2 |2181 |æ— 
|Elasticsearch |7.17.3 |9200 9300 |æ— 
|Kibana |7.17.3 |5601 |æ— 
|RabbitMQ |latest |5672 15672 |æ— 
|===

== ğŸ¯ å¿«é€Ÿå¼€å§‹
* é¡¹ç›®æ ¹ç›®å½•``goodsKill``ä¸­æ‰§è¡Œ
+
----
  mvn clean install
  æˆ–
  #è·³è¿‡å•å…ƒæµ‹è¯•
  mvn clean install -DskipTests
----

* é»˜è®¤ç«¯å£å¯åŠ¨nacosã€redisã€mysqlã€rabbitmqã€kafkaã€zookeeperã€elasticsearchï¼Œæˆ–è€…ä½¿ç”¨docker-compose{empty}footnote:[éœ€è¦å®‰è£…docker-desktop https://www.docker.com/products/docker-desktop/]å‘½ä»¤ï¼š
+
[source,bash]
----
  docker-compose -f goodskill-simple.yml up -d
----

* è¿›å…¥``goodskill-web/src/main/sql``ç›®å½•ï¼Œæ‰¾åˆ°``seckill.sql``æ–‡ä»¶ï¼Œåœ¨æœ¬åœ°mysqlæ•°æ®åº“ä¸­å»ºç«‹``seckill``ä»“åº“å¹¶æ‰§è¡Œå®Œæˆæ•°æ®åˆå§‹åŒ–æ“ä½œ
+

:warning-caption: âš ï¸ï¸

[WARNING]
docker-composeå¯åŠ¨MySQLé•œåƒæ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬ï¼Œå¦‚å·²æ‰§è¡Œè¿‡ä¸Šä¸€æ­¥æœ¬æ­¥éª¤å¯è·³è¿‡

* é…ç½®host
[source,text]
+
----
 127.0.0.1       kafka
 127.0.0.1       nacos
 127.0.0.1       redis
 127.0.0.1       mysql
 127.0.0.1       zookeeper
 127.0.0.1       mongo
 127.0.0.1       elasticsearch
 127.0.0.1       rabbitmq
 127.0.0.1       logstash
 ##å¦‚æœç½‘å…³æœåŠ¡éƒ¨ç½²åœ¨è¿œç¨‹æœºå™¨ï¼Œæ­¤å¤„æ”¹ä¸ºç›¸åº”çš„è¿œç¨‹æœºå™¨ip
 127.0.0.1       www.goodskill.com
----

* mainæ–¹æ³•è¿è¡Œ``OrderApplication``ç±»(è®¢å•æœåŠ¡)

* mainæ–¹æ³•è¿è¡Œ``SeckillApplication``ç±»(ç§’æ€ç®¡ç†æœåŠ¡æä¾›è€…)

* mainæ–¹æ³•è¿è¡Œ``SampleWebApplication``ç±»(æ¨¡æ‹Ÿç§’æ€webæœåŠ¡)

* å‘é€ä¸€ä¸ªç§’æ€æ¨¡æ‹Ÿè¯·æ±‚ï¼š
ç§’æ€æ´»åŠ¨id 1000ï¼Œå•†å“æ•°é‡10ï¼Œæ‰§è¡Œ20æ¬¡è´­ä¹°æ“ä½œï¼Œä½¿ç”¨sychronizedåŒæ­¥é”æ‰§è¡Œï¼Œä¾‹å¦‚ï¼š
+
å¯ç›´æ¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å‘é€æ¨¡æ‹Ÿç§’æ€è¯·æ±‚ï¼Œæ¯ä¸ªç§’æ€æ´»åŠ¨seckillIdå¯¹åº”å”¯ä¸€çš„ä¸€ä¸ªå•†å“idï¼Œæ¯æ¬¡æ‰§è¡Œæ¥å£æ—¶ä¼šæœ‰ä¸€ä¸ªåº“å­˜åˆå§‹åŒ–åŠ¨ä½œï¼Œæ¥å£æ‰§è¡Œå®Œæˆåå¯é‡å¤è°ƒç”¨

+
.ä½¿ç”¨sychronizedåŒæ­¥é”æ‰§è¡Œ
====
[source,bash]
curl -X POST "http://www.goodskill.com:8080/sychronized" \
-H "accept: */*" -H "Content-Type: application/json" -d \
"{ \"requestCount\": 20, \"seckillCount\": 10, \"seckillId\": 1000}"
====
+
.ä½¿ç”¨Redissonåˆ†å¸ƒå¼é”æ‰§è¡Œ
====
[source,bash]
curl -X POST "http://www.goodskill.com:8080/redisson" \
-H "accept: */*" -H "Content-Type: application/json" -d \
"{ \"requestCount\": 20, \"seckillCount\": 10, \"seckillId\": 1000}"
====
+
.ä½¿ç”¨Redissonåˆ†å¸ƒå¼é”æ‰§è¡Œï¼Œæ”¯æŒåŠ¨æ€é…ç½®åå°çº¿ç¨‹æ± æ ¸å¿ƒçº¿ç¨‹æ•°ä»¥åŠæœ€å¤§çº¿ç¨‹æ•°
====
[source,bash]
curl --location --request POST 'http://www.goodskill.com:8080/limit' \
--header 'User-Agent: apifox/1.0.0 (https://www.apifox.cn)' \
--header 'Content-Type: application/json' \
--data-raw '{
    "maxPoolSize": 10,
    "seckillId": 1000,
    "corePoolSize": 2,
    "seckillCount": 100,
    "requestCount": 120
}'
====
+
è¯·æ±‚é»˜è®¤å¼‚æ­¥æ‰§è¡Œï¼Œå¯åœ¨æ§åˆ¶å°æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—ï¼Œå¦‚æœæœ€ç»ˆæˆåŠŸäº¤æ˜“ç¬”æ•°ç­‰äºå•†å“æ•°é‡10åˆ™è¡¨ç¤ºæ²¡æœ‰å‡ºç°è¶…å–æˆ–è€…å°‘å–é—®é¢˜


== ğŸ•¹ï¸ï¸ å¯åŠ¨å…¶ä»–å¯é€‰é¡¹ç›®æ­¥éª¤
åœ¨å¿«é€Ÿå¼€å§‹éƒ¨åˆ†åŸºç¡€ä¸Šå¢åŠ ä»¥ä¸‹æ­¥éª¤å³å¯å¯åŠ¨ä¸€ä¸ªå®Œæ•´é¡¹ç›®

* è¿›å…¥``goodskill-gateway``æ¨¡å—ï¼Œé€šè¿‡``GatewayApplication``ç±»mainæ–¹æ³•å¯åŠ¨æœåŠ¡ç½‘å…³ï¼Œç»Ÿä¸€é€šè¿‡ç½‘å…³è®¿é—®å„ä¸ªæœåŠ¡

+
- `http://www.goodskill.com/api/order/**` å¯¹åº”è®¿é—®``goodskill-order-provider``æœåŠ¡
- `http://www.goodskill.com/api/seata/**` å¯¹åº”è®¿é—®``goodskill-seata``æœåŠ¡
- `http://www.goodskill.com/api/seckill/**` å¯¹åº”è®¿é—®``goodskill-seckill``æœåŠ¡
- `http://www.goodskill.com/api/auth/**` å¯¹åº”è®¿é—®``goodskill-auth``æœåŠ¡
- `http://www.goodskill.com/api/web/**` å¯¹åº”è®¿é—®``goodskill-web``æœåŠ¡


* å·²é›†æˆ``Sentinel``é™æµç»„ä»¶ï¼Œæ”¯æŒ``nacos``é…ç½®ä¸­å¿ƒæ–¹å¼æ¨é€é™æµè§„åˆ™ï¼Œä½¿ç”¨æ—¶éœ€å¯åŠ¨``Sentinel``æ§åˆ¶å°ï¼Œå¹¶ä»¥``18088``ç«¯å£å¯åŠ¨ï¼Œdockerç¯å¢ƒæš‚ä¸æ”¯æŒã€‚

* Seataåˆ†å¸ƒå¼äº‹åŠ¡æµ‹è¯•æ–¹æ³•è§ https://github.com/techa03/goodsKill/tree/master/goodskill-seata/README.md[Seataåˆ†å¸ƒå¼äº‹åŠ¡æµ‹è¯•ç¤ºä¾‹è¿è¡Œè¯´æ˜]

* mainæ–¹æ³•è¿è¡Œ``GoodskillAdminApplication``ç±»(å¾®æœåŠ¡å¥åº·çŠ¶æ€æŒ‡æ ‡ç›‘æ§)

== â“å¸¸è§é—®é¢˜
[qanda]
docker esé•œåƒå¯åŠ¨å¤±è´¥::

å‡ºç°æ­¤é—®é¢˜ä¸€èˆ¬ä¸ºlinuxç¯å¢ƒï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ `sysctl -w vm.max_map_count=262144`
ï¼Œæˆ–è€…ä¿®æ”¹/etc/sysctl.confæ–‡ä»¶ï¼Œè¿½åŠ ä»¥ä¸‹é…ç½®ï¼š
+
[source,text]
----
grep vm.max_map_count /etc/sysctl.conf
vm.max_map_count=262144
----

å¦‚ä½•ä½¿ç”¨æœ¬é¡¹ç›®è‡ªå®šä¹‰çš„OAuth2.0æˆæƒæœåŠ¡å™¨è¿›è¡Œç™»å½•æˆæƒï¼Ÿ::

å¾…å®Œå–„ã€‚ã€‚

é¡¹ç›®é›†æˆçš„å„ä¸ªæ¡†æ¶ä¹‹é—´ç›®å‰çš„å…¼å®¹æ€§å¦‚ä½•ï¼Ÿ::

æœ¬é¡¹ç›®ç›®å‰ä¾èµ–çš„å„ä¸ªä¸»æµæ¡†æ¶çš„ç‰ˆæœ¬æ¯”è¾ƒæ–°ï¼Œå°šæœªç»è¿‡å®Œæ•´æµ‹è¯•{empty}footnote:[é™„ https://start.aliyun.com/bootstrap.html[SpringCloudAlibaba]å…¼å®¹ç‰ˆæœ¬è¯´æ˜]ã€‚

æœåŠ¡å¯åŠ¨æ§åˆ¶å°æŠ¥ERRORæ—¥å¿— ``no available service found in cluster 'default', please make sure registry config correct and keep your seata server running`` å¦‚ä½•è§£å†³ï¼Ÿ::

å¯åŠ¨``seata-server``æœåŠ¡å³å¯ï¼ˆdocker-compose.ymlæ–‡ä»¶ä¸­å·²æä¾›ï¼‰ï¼Œå¯å‚ç…§Seataå®˜ç½‘æ·»åŠ nacosç›¸å…³é…ç½®ã€‚å¦‚æœªä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå¯å¿½ç•¥è¯¥é”™è¯¯ï¼Œä¸å½±å“æœåŠ¡æ­£å¸¸è¿è¡Œ

docker-composeæ— æ³•æ‹‰å–é•œåƒ::

hub.dockerè¢«å¢™ï¼Œå›½å†…å¯ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿå™¨ï¼Œå…·ä½“æ“ä½œè§ https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors[é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿå™¨]

ä½¿ç”¨JDK17ä»¥ä¸Šå¯åŠ¨é¡¹ç›®å¤±è´¥::

å¯åŠ¨æ—¶æ·»åŠ ä»¥ä¸‹jvmå‚æ•°ï¼Œä¾‹å¦‚ï¼š
+
[source,text]
----
--add-opens java.base/java.lang=ALL-UNNAMED
--add-opens java.base/java.util=ALL-UNNAMED
--add-opens java.base/java.util.concurrent=ALL-UNNAMED
--add-opens java.base/java.math=ALL-UNNAMED
--add-opens java.base/sun.reflect.generics.reflectiveObjects=ALL-UNNAMED
----

== ğŸ–²ï¸ çŠ¶æ€æœºè¯´æ˜
ç›®å‰ç§’æ€æ´»åŠ¨çŠ¶æ€çš„æ§åˆ¶åŸºäºSpring StatemachineçŠ¶æ€æœºå®ç°ï¼Œä½¿ç”¨çŠ¶æ€æœºçš„ä¼˜ç‚¹ï¼š

* ç»Ÿä¸€æ§åˆ¶æ´»åŠ¨çŠ¶æ€ï¼Œä¾¿äºçŠ¶æ€çš„é›†ä¸­ç»´æŠ¤ï¼›
* é˜²æ­¢ä¸šåŠ¡çŠ¶æ€è¢«éšæ„æ›´æ”¹ï¼Œä¿è¯çŠ¶æ€çš„å¯æ§æ›´æ–°ï¼›

==== çŠ¶æ€æœºæµç¨‹å›¾
image:./doc/shortcut/çŠ¶æ€æœº.png[image]


== ğŸ“šåˆ†åº“åˆ†è¡¨æƒ…å†µè¯´æ˜

|===
|è¡¨ |æ•°æ®åº“ |æ˜¯å¦åˆ†åº“ |åˆ†åº“å­—æ®µ |æ˜¯å¦åˆ†è¡¨ |åˆ†è¡¨å­—æ®µ

|success_killed |MySQL |æ˜¯ï¼ˆåŒä¸€æœåŠ¡å™¨ä¸­ï¼Œåˆ†ä¸ºseckillå’Œseckill_01ä¸¤ä¸ªåº“ï¼‰ |seckill_id |æ˜¯ï¼ˆåˆ†ä¸ºsuccess_killed_0,success_kill_1ä¸¤å¼ è¡¨ï¼‰ |user_phone
|===

:note-caption: ğŸ“¢
[NOTE]
å…¶ä»–è¡¨å‡æœªåˆ†åº“åˆ†è¡¨ï¼Œé»˜è®¤ä½¿ç”¨seckillä½œä¸ºä¸»åº“

=== APIæ¥å£è¯´æ˜

image:./doc/shortcut/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20180819224521.png[image]

== ğŸ’»ç›¸å…³é¡µé¢å±•ç¤º

==== æ¨¡æ‹Ÿç§’æ€æ¥å£æµ‹è¯•

image:doc/shortcut/æ¨¡æ‹Ÿç§’æ€æ¥å£æµ‹è¯•.gif[image]

== ğŸ“‘æ•°æ®åº“è¡¨ç»“æ„

image:doc/model_table.png[image]

== ğŸ“–å‚è€ƒæ–‡æ¡£

* è§£å†³Dockerå®¹å™¨è¿æ¥ Kafka è¿æ¥å¤±è´¥é—®é¢˜ï¼š`https://www.cnblogs.com/hellxz/p/why_cnnect_to_kafka_always_failure.html`
